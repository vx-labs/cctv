(function(t){function e(e){for(var a,c,o=e[0],s=e[1],u=e[2],m=0,d=[];m<o.length;m++)c=o[m],Object.prototype.hasOwnProperty.call(r,c)&&r[c]&&d.push(r[c][0]),r[c]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a]);l&&l(e);while(d.length)d.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,o=1;o<n.length;o++){var s=n[o];0!==r[s]&&(a=!1)}a&&(i.splice(e--,1),t=c(c.s=n[0]))}return t}var a={},r={app:0},i=[];function c(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=t,c.c=a,c.d=function(t,e,n){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)c.d(n,a,function(e){return t[e]}.bind(null,a));return n},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],s=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var l=s;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},1:function(t,e){},2:function(t,e){},3:function(t,e){},4:function(t,e){},8160:function(t){t.exports=JSON.parse('{"b":"vx-labs.eu.auth0.com","a":"4JkQIN7SYyLWx8FSHky1enzeo2NfjKEk"}')},cd49:function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",[n("AppDrawer"),n("v-app-bar",{attrs:{height:"73",app:"",flat:""}},[n("v-spacer"),n("v-toolbar-title",[n("v-icon",[t._v("mdi-cctv")])],1)],1),n("v-main",[n("v-container",{attrs:{fluid:""}},[n("router-view")],1)],1),n("v-footer",{attrs:{app:""}})],1)},i=[],c=(n("caad"),n("ac1f"),n("2532"),n("5319"),n("841c"),n("96cf"),n("1da1")),o=n("5530"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.authenticated?n("v-navigation-drawer",{attrs:{app:"",permanent:"","expand-on-hover":""},scopedSlots:t._u([{key:"append",fn:function(){return[n("NightModeSelector"),n("MQTTStatus"),n("AuthButton")]},proxy:!0}],null,!1,3548894554)},[n("v-list",{attrs:{dense:""}},[n("v-list-item",{staticClass:"px-2"},[n("v-list-item-avatar",[n("v-img",{attrs:{src:t.profile.picture}})],1),n("v-list-item-content",[n("v-list-item-title",[t._v(t._s(t.profile.given_name)+" "+t._s(t.profile.family_name.toUpperCase()))]),n("v-list-item-subtitle",[t._v(t._s(t.profile.email))])],1)],1)],1),n("v-divider"),n("v-list",{attrs:{nav:"",dense:""}},[n("v-list-item",{attrs:{link:"",to:"/"}},[n("v-list-item-icon",[n("v-icon",[t._v("mdi-home")])],1),n("v-list-item-title",[t._v("Home page")])],1)],1)],1):t._e()},u=[],l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-list",{attrs:{nav:"",dense:""}},[n("v-list-item",{on:{click:function(e){t.$vuetify.theme.dark=!t.$vuetify.theme.dark}}},[n("v-list-item-icon",[n("v-icon",[t._v("mdi-theme-light-dark")])],1),n("v-list-item-title",[t._v(" Switch theme to "+t._s(t.$vuetify.theme.dark?"light":"dark"))])],1)],1)},m=[],d=a["a"].extend({}),v=d,h=n("2877"),p=n("6544"),f=n.n(p),g=n("132d"),b=n("8860"),w=n("da13"),k=n("34c3"),x=n("5d23"),_=Object(h["a"])(v,l,m,!1,null,null,null),C=_.exports;f()(_,{VIcon:g["a"],VList:b["a"],VListItem:w["a"],VListItemIcon:k["a"],VListItemTitle:x["c"]});var O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-list",{attrs:{nav:"",dense:""}},[n("v-list-item",{attrs:{disabled:t.isMQTTConnecting||!t.isMQTTConnected}},[n("v-list-item-icon",[t.isMQTTConnecting?n("v-progress-circular",{attrs:{indeterminate:"",width:"2"}}):n("span",[t.isMQTTConnected?n("v-icon",[t._v("mdi-cloud-outline")]):n("v-icon",[t._v("mdi-cloud-off-outline")])],1)],1),n("v-list-item-title",[t._v(t._s(t.isMQTTConnecting?"Connecting...":t.isMQTTConnected?"Connected":"Disconnected"))])],1)],1)},j=[],V=n("2f62"),y=a["a"].extend({computed:Object(o["a"])({},Object(V["c"])(["isMQTTConnected","isMQTTConnecting"]))}),I=y,S=n("490a"),T=Object(h["a"])(I,O,j,!1,null,null,null),R=T.exports;f()(T,{VIcon:g["a"],VList:b["a"],VListItem:w["a"],VListItemIcon:k["a"],VListItemTitle:x["c"],VProgressCircular:S["a"]});var A=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-list",{attrs:{nav:"",dense:""}},[n("v-list-item",{on:{click:t.toogleAuthentication}},[n("v-list-item-icon",[t.authenticated?n("v-icon",[t._v("mdi-logout")]):n("v-icon",[t._v("mdi-login")])],1),n("v-list-item-title",{domProps:{innerHTML:t._s(t.authenticated?"Logout":"Login")}})],1)],1)},L=[],q=a["a"].extend({name:"AuthButton",computed:Object(o["a"])({},Object(V["c"])(["authenticated"])),methods:Object(o["a"])({},Object(V["b"])(["toogleAuthentication"]))}),P=q,$=Object(h["a"])(P,A,L,!1,null,null,null),M=$.exports;f()($,{VIcon:g["a"],VList:b["a"],VListItem:w["a"],VListItemIcon:k["a"],VListItemTitle:x["c"]});var D=a["a"].extend({components:{AuthButton:M,MQTTStatus:R,NightModeSelector:C},computed:Object(o["a"])({},Object(V["c"])(["authenticated","profile"]))}),Q=D,F=n("ce7e"),B=n("adda"),E=n("8270"),U=n("f774"),z=Object(h["a"])(Q,s,u,!1,null,null,null),H=z.exports;f()(z,{VDivider:F["a"],VIcon:g["a"],VImg:B["a"],VList:b["a"],VListItem:w["a"],VListItemAvatar:E["a"],VListItemContent:x["a"],VListItemIcon:k["a"],VListItemSubtitle:x["b"],VListItemTitle:x["c"],VNavigationDrawer:U["a"]});var N=a["a"].extend({name:"App",components:{AppDrawer:H},methods:Object(o["a"])({},Object(V["b"])(["handleAuthentication"])),mounted:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.handleAuthentication();case 2:t.$store.getters.authenticated?(Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("refreshUsername");case 2:t.$store.dispatch("startMQTTClient");case 3:case"end":return e.stop()}}),e)})))(),window.location.search.includes("code=")&&(n=t.$store.getters.lastPath,void 0!==n?t.$router.replace(n):t.$router.replace(window.location.pathname))):console.log("auth failed");case 3:case"end":return e.stop()}}),e)})))()}}),W=N,X=n("7496"),Y=n("40dc"),J=n("a523"),G=n("553a"),K=n("f6c4"),Z=n("2fa4"),tt=n("2a7f"),et=Object(h["a"])(W,r,i,!1,null,null,null),nt=et.exports;f()(et,{VApp:X["a"],VAppBar:Y["a"],VContainer:J["a"],VFooter:G["a"],VIcon:g["a"],VMain:K["a"],VSpacer:Z["a"],VToolbarTitle:tt["a"]});var at=n("8c4f"),rt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",{attrs:{fluid:""}},[t.isAlarmArmed?t._e():n("v-overlay",{attrs:{opacity:"0.8",absolute:""}},[t._v(" Alarm is currently disarmed. ")]),n("v-row",t._l(t.cameras,(function(t){return n("v-col",{key:t.name,attrs:{xs:"12",md:"6"}},[n("CameraView",{attrs:{camera:t}})],1)})),1)],1)},it=[],ct=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-hover",{scopedSlots:t._u([{key:"default",fn:function(e){var a=e.hover;return[n("v-card",{class:{"on-hover":a},attrs:{outlined:"",elevation:a?4:0}},[n("v-img",{staticClass:"white--text align-end",attrs:{dark:"",src:t.encodedImage}},["ready"!==t.camera.state?n("v-overlay",{attrs:{opacity:"0.8",absolute:""}},[t._v(" "+t._s(t.camera.name)+" is unavailable ("+t._s(t.camera.state)+"). ")]):n("v-row",{attrs:{align:"end",justify:"space-around"}},[n("v-col",[n("v-card-title",[t._v(t._s(t.camera.name))])],1),n("v-col",{attrs:{cols:"3"}},[n("v-row",{attrs:{"no-gutters":""}},[n("v-col",[n("v-spacer")],1),n("v-col",[n("v-btn",{attrs:{icon:""},on:{click:function(e){return t.moveCameraY({name:t.camera.name,steps:50})}}},[n("v-icon",[t._v("mdi-menu-up")])],1)],1),n("v-col",[n("v-spacer")],1)],1),n("v-row",{attrs:{"no-gutters":""}},[n("v-col",[n("v-btn",{attrs:{icon:""},on:{click:function(e){return t.moveCameraX({name:t.camera.name,steps:-150})}}},[n("v-icon",[t._v("mdi-menu-left")])],1)],1),n("v-col",[n("v-btn",{attrs:{icon:""},on:{click:t.refresh}},[n("v-icon",[t._v("mdi-refresh")])],1)],1),n("v-col",[n("v-btn",{attrs:{icon:""},on:{click:function(e){return t.moveCameraX({name:t.camera.name,steps:150})}}},[n("v-icon",[t._v("mdi-menu-right")])],1)],1)],1),n("v-row",{attrs:{"no-gutters":""}},[n("v-col",[n("v-spacer")],1),n("v-col",[n("v-btn",{attrs:{icon:""},on:{click:function(e){return t.moveCameraY({name:t.camera.name,steps:-50})}}},[n("v-icon",[t._v("mdi-menu-down")])],1)],1),n("v-col",[n("v-spacer")],1)],1)],1)],1)],1)],1)]}}])})},ot=[],st=(n("b0c0"),a["a"].extend({name:"CameraView",props:{camera:Object},computed:{encodedImage:function(){return"data:image/jpeg;base64,".concat(this.camera.lastFrame)}},methods:Object(o["a"])({refresh:function(){this.$store.dispatch("refreshFrame",this.camera.name)}},Object(V["b"])(["moveCameraX","moveCameraY"]))})),ut=st,lt=n("8336"),mt=n("b0af"),dt=n("99d9"),vt=n("62ad"),ht=n("ce87"),pt=n("a797"),ft=n("0fd9"),gt=Object(h["a"])(ut,ct,ot,!1,null,null,null),bt=gt.exports;f()(gt,{VBtn:lt["a"],VCard:mt["a"],VCardTitle:dt["a"],VCol:vt["a"],VHover:ht["a"],VIcon:g["a"],VImg:B["a"],VOverlay:pt["a"],VRow:ft["a"],VSpacer:Z["a"]});var wt={name:"Home",components:{CameraView:bt},computed:Object(o["a"])({},Object(V["c"])(["cameras","isAlarmArmed"]))},kt=wt,xt=Object(h["a"])(kt,rt,it,!1,null,null,null),_t=xt.exports;f()(xt,{VCol:vt["a"],VContainer:J["a"],VOverlay:pt["a"],VRow:ft["a"]});var Ct=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",[n("h2",{staticClass:"text-h2"},[t._v("VX-Labs CCTV Platform")]),n("v-row",{staticClass:"ma-4"},[n("span",{staticClass:"font-weight-light"},[t._v(" Greetings ! "),n("br"),t._v("Welcome to VX-Labs CCTV Platform. "),n("br"),t._v("From here, you can login into your account, or read some documentation about the platform. "),n("br")])]),n("v-row",{staticClass:"ma-4"},[n("v-card",{staticClass:"ma-2",attrs:{outlined:"",loading:t.authenticationPending}},[n("v-list",[n("v-subheader",[t._v("Login")]),n("v-list-item-group",[n("v-list-item",{on:{click:function(e){return t.doLogin()}}},[n("v-list-item-icon",[n("v-icon",[t._v("mdi-login")])],1),n("v-list-item-content",[n("v-list-item-title",[t._v("Access your account")]),n("v-list-item-subtitle",[n("span",{staticClass:"font-weight-light"},[t._v("Access your account, or create a new one, by clicking this link")])])],1)],1),n("v-list-item",{attrs:{to:"/support"}},[n("v-list-item-icon",[n("v-icon",[t._v("mdi-email")])],1),n("v-list-item-content",[n("v-list-item-title",[t._v("Contact support")]),n("v-list-item-subtitle",[n("span",{staticClass:"font-weight-light"},[t._v("Got technical issues? Contact support now.")])])],1)],1)],1)],1)],1),n("v-card",{staticClass:"ma-2",attrs:{outlined:""}},[n("v-list",[n("v-subheader",[t._v("Learn more")]),n("v-list-item-group",[n("v-list-item",{attrs:{to:"/about"}},[n("v-list-item-icon",[n("v-icon",[t._v("mdi-book")])],1),n("v-list-item-content",[n("v-list-item-title",[t._v("CCTV Platform")]),n("v-list-item-subtitle",[n("span",{staticClass:"font-weight-light"},[t._v("What's this platform?")])])],1)],1)],1)],1)],1)],1)],1)},Ot=[],jt=(n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d"),{computed:Object(o["a"])({},Object(V["c"])(["authenticated","authenticationPending"])),methods:Object(o["a"])(Object(o["a"])({},Object(V["b"])(["login"])),{},{doLogin:function(){var t=new URLSearchParams(window.location.search);return this.login(t.get("lastPage"))},doCheck:function(){if(this.authenticated){var t=new URLSearchParams(window.location.search);this.$router.replace(t.get("lastPage"))}}}),mounted:function(){var t=this;this.$nextTick((function(){return t.doCheck()}))},watch:{authenticated:function(){this.doCheck()}}}),Vt=jt,yt=n("1baa"),It=n("e0c7"),St=Object(h["a"])(Vt,Ct,Ot,!1,null,null,null),Tt=St.exports;f()(St,{VCard:mt["a"],VContainer:J["a"],VIcon:g["a"],VList:b["a"],VListItem:w["a"],VListItemContent:x["a"],VListItemGroup:yt["a"],VListItemIcon:k["a"],VListItemSubtitle:x["b"],VListItemTitle:x["c"],VRow:ft["a"],VSubheader:It["a"]});n("7db0"),n("c740"),n("45fc"),n("25f0"),n("1276"),n("2ca0");var Rt=n("d4ec"),At=n("e7fc"),Lt=(n("b64b"),n("bee2")),qt=n("9767"),Pt=function(){function t(e,n){Object(Rt["a"])(this,t),this.auth0=new qt["a"]({domain:e,client_id:n,redirect_uri:window.location.origin+"/login",cacheLocation:"localstorage",connection:"google-oauth2",audience:"https://api.iot.cloud.vx-labs.net"})}return Object(Lt["a"])(t,[{key:"login",value:function(t){return this.auth0.loginWithRedirect({appState:t})}},{key:"logout",value:function(){var t=Object.keys(localStorage),e=t.length;while(e--){var n=localStorage.key(e);if(null!==n&&n.startsWith("@@auth0")){localStorage.removeItem(n);break}}return this.auth0.logout({returnTo:window.location.origin})}},{key:"handleAuthentication",value:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.auth0.getTokenSilently();case 3:return t.abrupt("return");case 6:return t.prev=6,t.t0=t["catch"](0),t.next=10,this.auth0.handleRedirectCallback();case 10:return e=t.sent,t.abrupt("return",e.appState);case 12:case"end":return t.stop()}}),t,this,[[0,6]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"userProfile",value:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.auth0.getUser());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"token",value:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.auth0.getTokenSilently();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}]),t}(),$t=n("8160"),Mt=new Pt($t["b"],$t["a"]),Dt=function t(){Object(Rt["a"])(this,t),this.authenticated=!1,this.authenticationPending=!1},Qt={state:new Dt,getters:{authenticated:function(t){return t.authenticated},authenticationPending:function(t){return t.authenticationPending},lastPath:function(t){return t.lastPath},profile:function(t){return t.profile}},mutations:{authenticationPending:function(t){t.authenticationPending=!0},authenticationFailed:function(t){t.authenticationPending=!1},appStateRecovered:function(t,e){t.lastPath=e},profileFetched:function(t,e){t.profile=e,t.authenticated=!0,t.authenticationPending=!1},logout:function(t){t.authenticated=!1}},actions:{toogleAuthentication:function(t){var e=t.state,n=t.dispatch;return e.authenticated?n("logout"):n("login")},login:function(t,e){return Object(c["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t.commit,a("authenticationPending"),n.abrupt("return",Mt.login(e));case 3:case"end":return n.stop()}}),n)})))()},logout:function(t){var e=t.commit;Mt.logout(),e("logout")},refreshToken:function(){return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",Mt.token());case 1:case"end":return t.stop()}}),t)})))()},handleAuthentication:function(t){return Object(c["a"])(regeneratorRuntime.mark((function e(){var n,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.commit,n("authenticationPending"),e.prev=2,e.next=5,Mt.handleAuthentication();case 5:return a=e.sent,e.next=8,Mt.userProfile();case 8:r=e.sent,void 0!==a&&n("appStateRecovered",a),n("profileFetched",r),e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](2),n("authenticationFailed");case 16:case"end":return e.stop()}}),e,null,[[2,13]])})))()}}},Ft=Qt,Bt=n("bc3a"),Et=n.n(Bt),Ut=function(){function t(e){Object(Rt["a"])(this,t),this.httpClient=Et.a.create({baseURL:e,timeout:3e3})}return Object(Lt["a"])(t,[{key:"getAccountInformations",value:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.httpClient.get("/account/info/",{headers:{Authorization:"Bearer ".concat(e)}});case 2:return n=t.sent,t.abrupt("return",n.data);case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"createAccount",value:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.httpClient.post("/account/",{},{headers:{Authorization:"Bearer ".concat(e)}});case 2:return n=t.sent,t.abrupt("return",n.data);case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"createDevice",value:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(e,n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.httpClient.post("/devices/",{name:n.name,password:n.password,active:n.active},{headers:{Authorization:"Bearer ".concat(e)}}));case 1:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"deleteDevice",value:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(e,n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.httpClient.delete("/devices/".concat(n),{headers:{Authorization:"Bearer ".concat(e)}}));case 1:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"listDevices",value:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.httpClient.get("/devices/",{headers:{Authorization:"Bearer ".concat(e)}});case 2:return n=t.sent,t.abrupt("return",n.data.sort((function(t,e){return t.name.localeCompare(e.name)})));case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()}]),t}(),zt=function t(){Object(Rt["a"])(this,t),this.client=new Ut("https://api.iot.cloud.vx-labs.net")};a["a"].use(V["a"]);var Ht=localStorage.getItem("cctv:instance");null===Ht&&(Ht=Math.random().toString(36).substr(2,8),localStorage.setItem("cctv:instance",Ht));var Nt=function t(){Object(Rt["a"])(this,t),this.connected=!1,this.connecting=!1,this.offlineReason="",this.clientId="cctv-console-".concat(Ht),this.client=void 0};function Wt(t,e){for(var n=t.split("/"),a=e.split("/"),r=0,i=n.length;r<i;r++){if("#"===a[r])return!0;if("+"!==a[r]&&a[r]!==n[r])return!1}return"#"===a[r]&&(r+=1),r===a.length}var Xt=function t(){Object(Rt["a"])(this,t),this.username=void 0,this.api=new zt,this.cameras=[],this.alarmArmed=!1,this.mqtt=new Nt},Yt=new V["a"].Store({state:new Xt,getters:{isMQTTConnecting:function(t){return t.mqtt.connecting},isMQTTConnected:function(t){return t.mqtt.connected},username:function(t){return t.username},cameras:function(t){return t.cameras},isAlarmArmed:function(t){return t.alarmArmed}},mutations:{usernameSet:function(t,e){t.username=e},alarmArmed:function(t){t.alarmArmed=!0},alarmDisarmed:function(t){t.alarmArmed=!1},mqttStarted:function(t,e){t.mqtt.client=e},mqttConnected:function(t){t.mqtt.connecting=!1,t.mqtt.connected=!0},mqttConnecting:function(t){t.mqtt.connected=!1,t.mqtt.connecting=!0},mqttDisconnected:function(t,e){t.mqtt.offlineReason=e,t.mqtt.connected=!1},cameraDiscovered:function(t,e){t.cameras.push({name:e,state:"lost"}),t.cameras.sort((function(t,e){return t.name.localeCompare(e.name)}))},cameraFrameUpdated:function(t,e){var n=t.cameras.findIndex((function(t){return t.name===e.name}));n>-1&&a["a"].set(t.cameras,n,Object.assign({},t.cameras[n],{lastFrame:e.frame}))},cameraStateUpdated:function(t,e){var n=t.cameras.findIndex((function(t){return t.name===e.name}));n>-1&&a["a"].set(t.cameras,n,Object.assign({},t.cameras[n],{state:e.state}))}},actions:{refreshUsername:function(t){return Object(c["a"])(regeneratorRuntime.mark((function e(){var n,a,r,i,c,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.state,a=t.dispatch,r=t.commit,e.next=3,a("refreshToken",{},{root:!0});case 3:return i=e.sent,e.prev=4,e.next=7,n.api.client.getAccountInformations(i);case 7:c=e.sent,r("usernameSet",c.usernames[0]),e.next=17;break;case 11:return e.prev=11,e.t0=e["catch"](4),e.next=15,n.api.client.createAccount(i);case 15:o=e.sent,r("usernameSet",o.usernames[0]);case 17:case"end":return e.stop()}}),e,null,[[4,11]])})))()},refreshFrame:function(t,e){return Object(c["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=t.state,!a.cameras.some((function(t){return t.name===e}))){n.next=5;break}return n.abrupt("return",new Promise((function(t,n){void 0!=a.mqtt.client?a.mqtt.client.publish("devices/".concat(e,"/dafang/frame/set"),"true",{qos:1},(function(e){e?n(e):t()})):t()})));case 5:throw new Error("unknown camera");case 6:case"end":return n.stop()}}),n)})))()},moveCameraX:function(t,e){return Object(c["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=t.state,t.dispatch,!a.cameras.some((function(t){return t.name===e.name}))){n.next=3;break}return n.abrupt("return",new Promise((function(t,n){void 0!=a.mqtt.client?a.mqtt.client.publish("devices/".concat(e.name,"/dafang/x_axis_incr/set"),e.steps.toString(),{qos:1},(function(e){e?n():t()})):t()})));case 3:case"end":return n.stop()}}),n)})))()},moveCameraY:function(t,e){return Object(c["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.dispatch,a=t.state,!a.cameras.some((function(t){return t.name===e.name}))){n.next=3;break}return n.abrupt("return",new Promise((function(t,n){void 0!=a.mqtt.client?a.mqtt.client.publish("devices/".concat(e.name,"/dafang/y_axis_incr/set"),e.steps.toString(),{qos:1},(function(e){e?n():t()})):t()})));case 3:case"end":return n.stop()}}),n)})))()},startMQTTClient:function(t){return Object(c["a"])(regeneratorRuntime.mark((function e(){var n,a,r,i,c,o,s,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.commit,a=t.state,t.getters,r=t.dispatch,n("mqttConnecting"),e.next=4,r("refreshToken");case 4:return i=e.sent,e.next=7,a.api.client.listDevices(i);case 7:if(c=e.sent,o=c.find((function(t){return t.name===a.mqtt.clientId})),void 0===o){e.next=12;break}return e.next=12,a.api.client.deleteDevice(i,o.id);case 12:return s=Math.random().toString(36).substr(2,16),e.next=15,a.api.client.createDevice(i,{active:!0,name:a.mqtt.clientId,password:s});case 15:u=Object(At["connect"])("wss://broker.iot.cloud.vx-labs.net:443/mqtt",{connectTimeout:3e3,protocolId:"MQIsdp",protocolVersion:3,clientId:a.mqtt.clientId,username:a.username,password:s,host:"broker.iot.cloud.vx-labs.net",hostname:"broker.iot.cloud.vx-labs.net"}),n("mqttStarted",u),u.on("message",(function(t,e){var r=t.toString();if(Wt(r,"devices/+/dafang/frame")){if(e.length>0){var i=r.split("/");n("cameraFrameUpdated",{name:i[1],frame:e.toString("base64")})}}else if(Wt(r,"devices/+/$nodes")){var c=r.split("/");e.toString().split(",").some((function(t){return"dafang"===t}))&&(a.cameras.some((function(t){return t.name===c[1]}))||(n("cameraDiscovered",c[1]),u.subscribe("devices/".concat(c[1],"/dafang/#"),{qos:1}),u.subscribe("devices/".concat(c[1],"/$state"),{qos:1})))}else if(Wt(r,"devices/+/$state")){var o=r.split("/");a.cameras.some((function(t){return t.name===o[1]}))&&n("cameraStateUpdated",{name:o[1],state:e.toString()})}else if(Wt(r,"devices/+/$homie")){var s=r.split("/");e.toString().startsWith("3.")&&u.subscribe("devices/".concat(s[1],"/$nodes"),{qos:1})}else Wt(r,"devices/$broadcast/alarm")&&("arm"==e.toString()?n("alarmArmed"):n("alarmDisarmed"))})),u.on("connect",(function(){u.subscribe("devices/$broadcast/alarm",{qos:1}),u.subscribe("devices/+/$homie",{qos:1},(function(t){null===t?n("mqttConnected"):console.log(t)}))})),u.on("error",(function(t){return n("mqttDisconnected",t)})),u.on("reconnect",(function(){n("mqttConnecting")})),u.on("disconnect",(function(){n("mqttDisconnected","Broker ask us to disconnect")}));case 22:case"end":return e.stop()}}),e)})))()}},modules:{session:Ft}});a["a"].use(at["a"]);var Jt=function(t,e,n){Yt.getters.authenticated?n():n({path:"/login",query:{lastPage:t.fullPath}})},Gt=[{path:"/",name:"Home",component:_t,beforeEnter:Jt},{path:"/login",component:Tt}],Kt=new at["a"]({mode:"history",base:"/",routes:Gt}),Zt=Kt,te=n("f309");a["a"].use(te["a"]);var ee=new te["a"]({});n("d5e8"),n("5363");a["a"].config.productionTip=!1,new a["a"]({router:Zt,store:Yt,vuetify:ee,render:function(t){return t(nt)}}).$mount("#app")}});
//# sourceMappingURL=app.dea72d19.js.map